{"files":[{"id":"9df498c8-a524-4d76-b65a-aa5008a750b3","name":"Code","type":"server_js","source":"function createForm() {\n  var item \u003d \"Team lunch Voting Form\";\n  var form \u003d FormApp.create(item).setTitle(item);\n\n  var files \u003d DriveApp.getFilesByName(\u0027Food history\u0027);\n  var ss \u003d {};\n  ss.getName \u003d function() {return \u0027\u0027;};\n  while (files.hasNext() \u0026\u0026 ss.getName() !\u003d\u003d \u0027Food history\u0027) {\n    ss \u003d files.next();\n  }\n  ss \u003d SpreadsheetApp.open(ss);\n  var sheet \u003d ss.getSheetByName(\u0027History\u0027);\n\n  var previous \u003d sheet.getRange(1, sheet.getLastColumn(), sheet.getLastRow()).getValues() || [];\n  var description \u003d \u0027Previous locations (most recent to least recent):\u0027;\n  for (var i in previous) {\n    if(i !\u003d\u003d \u00270\u0027)\n      description +\u003d \u0027\\n\u0027+ previous[i];\n  }\n  form.setDescription(description);\n  \n  // declare choices of food places\n  var places \u003d [\u0027Asian Bowl\u0027, \u0027Bikkuri\u0027, \u0027Kaiju\u0027, \u0027Khao San\u0027, \u0027Golden Thai\u0027, \u0027Gyu Kaku\u0027,\n               \u0027On The Rocks\u0027, \u0027Sukhothai\u0027, \u0027Noodle King\u0027, \u0027Phoenix\u0027, \u0027Hokkaido Ramen Santouka\u0027,\n               \u0027TCJ\u0027, \u0027Yummy Bar-B-Q\u0027, \u0027Nami\u0027, \u0027Ramen Raijin\u0027, \u0027Shwarma place next to TCJ\u0027];\n  // add the multiple choice\n  form.addMultipleChoiceItem().showOtherOption(true).setTitle(\u0027Restaurant\u0027).setChoiceValues(places).setRequired(true);\n\n  ScriptApp.newTrigger(\u0027updateResponse\u0027).forForm(form).onFormSubmit().create();\n\n  var emails \u003d [\"albion.fung@caseware.com\"];\n  var subject \u003d \"Vote for lunch \" + (new Date).toLocaleDateString();\n  var htmlBody \u003d \"\u003cp\u003eFill out form: \" + form.getPublishedUrl() + \"\u003c/p\u003e\u003cp\u003eExcel history: \" +\n    \"https://docs.google.com/spreadsheets/d/1ece_HgYxSAWhpihP_RMzCqnJiPGM30DJ471RSMXLKR0/edit#gid\u003d0 \u003c/p\u003e\";\n  for (i in emails) {\n    MailApp.sendEmail({\n      to : emails[i],\n      subject: subject,\n      htmlBody: htmlBody\n    });\n  }\n};\n\nfunction updateResponse(e) {\n  var files \u003d DriveApp.getFilesByName(\u0027Food history\u0027);\n  var ss \u003d {};\n  ss.getName \u003d function() {return \u0027\u0027;};\n  while (files.hasNext() \u0026\u0026 ss.getName() !\u003d\u003d \u0027Food history\u0027) {\n    ss \u003d files.next();\n  }\n  ss \u003d SpreadsheetApp.open(ss);\n\n  //TODO: other option\n  // Create new row if necessary\n  var date \u003d new Date().toLocaleDateString();\n  var sheet \u003d ss.getSheetByName(\u0027History\u0027);\n  var lastRow \u003d sheet.getLastRow();\n  if(lastRow \u003d\u003d\u003d 0) {\n   sheet.appendRow([\u0027Date\u0027].concat(places));\n   lastRow +\u003d 1;\n  }\n  var lastDate \u003d sheet.getRange(lastRow, 1);\n  if(new Date(lastDate.getValue()).toLocaleDateString() !\u003d\u003d date) {\n    sheet.getRange(lastRow + 1, 1).setValue(date);\n    lastRow +\u003d 1;\n  }\n  \n  var response, col;\n  var data \u003d sheet.getDataRange().getValues();\n  var formResponse \u003d e.response.getItemResponses();\n  response \u003d formResponse[0].getResponse();\n  col \u003d data[0].indexOf(response) + 1;\n  Logger.log(col);\n  if(col \u003d\u003d\u003d 0) {\n    sheet.insertColumnAfter(sheet.getLastColumn());\n    col \u003d sheet.getLastColumn();\n    sheet.getRange(1, col).setValue(\u0027Unknown Data\u0027);\n  }\n  \n  var newVal;\n  Logger.log(sheet.getRange(lastRow, col).getValue());\n  if(sheet.getRange(lastRow, col).getValue())\n    newVal \u003d sheet.getRange(lastRow, col).getValue() + 1;\n  else\n    newVal \u003d 1;\n  sheet.getRange(lastRow, col).setValue(newVal);\n  \n  sheet.getRange(lastRow, sheet.getLastColumn()).setValue(\u0027\u003dINDEX(B$1:R$1, 1, MATCH(MAX(B\u0027 + lastRow + \n                                                          \u0027:R\u0027 + lastRow + \u0027), B\u0027 + lastRow + \u0027:R\u0027 + lastRow +\n                                                          \u0027, 0))\u0027);\n};\n"},{"id":"5f11715e-6391-4a36-ba21-8497070528e7","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\"\n}"}]}